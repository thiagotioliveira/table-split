<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configura√ß√µes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Settings specific styles */
    .settings-layout {
      max-width: 800px;
    }

    .settings-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
    }

    .settings-section-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .settings-section-header h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .settings-section-header p {
      font-size: 0.875rem;
      color: var(--muted);
    }

    .settings-section-body {
      padding: 1.5rem;
    }

    .logo-upload {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .logo-preview {
      width: 6rem;
      height: 6rem;
      border-radius: var(--radius-lg);
      border: 2px dashed var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--background-secondary);
      overflow: hidden;
      flex-shrink: 0;
    }

    .logo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .logo-preview svg {
      width: 2rem;
      height: 2rem;
      color: var(--muted);
    }

    .logo-upload-actions {
      flex: 1;
    }

    .logo-upload-actions p {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }

    .form-row-3 {
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 1rem;
    }

    @media (min-width: 640px) {
      .form-row-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .hours-grid {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .hours-row {
      display: grid;
      grid-template-columns: 5rem 1fr 1fr auto;
      gap: 0.75rem;
      align-items: center;
    }

    @media (max-width: 640px) {
      .hours-row {
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }

      .hours-row .day-label {
        grid-column: span 2;
      }
    }

    .day-label {
      font-size: 0.875rem;
      font-weight: 500;
    }

    .hours-input {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font: inherit;
      font-size: 0.875rem;
      background: var(--background);
    }

    .hours-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .closed-badge {
      font-size: 0.75rem;
      color: var(--muted);
      background: var(--background-secondary);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius);
    }

    .color-picker-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .color-preview {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .color-input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .danger-zone {
      border-color: rgba(239, 68, 68, 0.3);
    }

    .danger-zone .settings-section-header {
      border-bottom-color: rgba(239, 68, 68, 0.3);
    }

    .danger-zone h2 {
      color: var(--destructive);
    }

    .settings-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 0;
      position: sticky;
      bottom: 0;
      background: var(--background);
      border-top: 1px solid var(--border);
      margin-top: 1rem;
    }

    .input-with-addon {
      display: flex;
    }

    .input-with-addon .form-input {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .input-addon {
      padding: 0.625rem 0.75rem;
      background: var(--background-secondary);
      border: 1px solid var(--border);
      border-left: none;
      border-radius: 0 var(--radius) var(--radius) 0;
      font-size: 0.875rem;
      color: var(--muted);
    }

    /* Language checkboxes */
    .language-checkboxes {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 0.5rem;
    }

    @media (min-width: 640px) {
      .language-checkboxes {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .language-checkbox {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
    }

    .language-checkbox:hover {
      border-color: var(--primary);
      background: var(--primary-light);
    }

    .language-checkbox input {
      display: none;
    }

    .language-checkbox .checkmark {
      width: 1.25rem;
      height: 1.25rem;
      border: 2px solid var(--border);
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .language-checkbox input:checked+.checkmark {
      background: var(--primary);
      border-color: var(--primary);
    }

    .language-checkbox input:checked+.checkmark::after {
      content: '‚úì';
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .language-checkbox input:disabled+.checkmark {
      opacity: 0.5;
    }

    .lang-flag {
      font-size: 1.25rem;
    }

    .lang-name {
      flex: 1;
      font-size: 0.875rem;
    }

    .lang-badge {
      font-size: 0.625rem;
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
    }

    .language-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .language-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      background: var(--background-secondary);
      border: 1px solid var(--border);
      border-radius: 9999px;
      font-size: 0.75rem;
      cursor: grab;
    }

    .language-tag.primary {
      background: var(--primary-light);
      border-color: var(--primary);
      color: var(--primary);
    }

    .language-tag.dragging {
      opacity: 0.5;
      transform: scale(1.05);
    }

    .language-tag.drag-over {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    .language-tags-hint {
      font-size: 0.6875rem;
      color: var(--muted-foreground);
      margin-top: 0.25rem;
    }

    /* Profile Tags */
    .profile-tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .profile-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--accent);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.875rem;
      cursor: grab;
    }

    .profile-tag .tag-emoji {
      font-size: 1rem;
    }

    .profile-tag .tag-remove {
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--muted);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: var(--muted-foreground);
      font-size: 0.75rem;
    }

    .profile-tag .tag-remove:hover {
      background: var(--destructive);
      color: white;
    }

    .add-tag-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 0.75rem;
      background: var(--background);
      border: 2px dashed var(--border);
      border-radius: 20px;
      font-size: 0.875rem;
      color: var(--muted-foreground);
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-tag-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .tag-suggestions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    @media (min-width: 640px) {
      .tag-suggestions {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .tag-suggestion {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tag-suggestion:hover {
      border-color: var(--primary);
      background: var(--accent);
    }

    .tag-suggestion.selected {
      border-color: var(--primary);
      background: var(--accent);
    }

    /* Multi-period hours */
    .day-schedule {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 0.75rem;
      overflow: hidden;
    }

    .day-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--background-secondary);
      border-bottom: 1px solid var(--border);
    }

    .day-header.closed {
      opacity: 0.6;
    }

    .day-name {
      font-weight: 600;
      font-size: 0.9375rem;
    }

    .day-actions {
      display: flex;
      gap: 0.5rem;
    }

    .periods-container {
      padding: 0.75rem 1rem;
    }

    .period-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .period-row:last-child {
      margin-bottom: 0;
    }

    .period-row .hours-input {
      flex: 1;
      max-width: 100px;
    }

    .period-separator {
      color: var(--muted-foreground);
      font-size: 0.875rem;
    }

    .remove-period-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      color: var(--muted-foreground);
    }

    .remove-period-btn:hover {
      background: var(--destructive);
      border-color: var(--destructive);
      color: white;
    }

    .add-period-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      background: none;
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      font-size: 0.8125rem;
      color: var(--muted-foreground);
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .add-period-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Photo Gallery */
    .gallery-upload-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }

    @media (min-width: 640px) {
      .gallery-upload-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .gallery-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-item-actions {
      position: absolute;
      top: 0.375rem;
      right: 0.375rem;
      display: flex;
      gap: 0.25rem;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .gallery-item:hover .gallery-item-actions {
      opacity: 1;
    }

    .gallery-item-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
    }

    .gallery-item-btn:hover {
      background: var(--destructive);
    }

    .gallery-item-btn svg {
      width: 14px;
      height: 14px;
    }

    .gallery-item.cover::after {
      content: 'Capa';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0.25rem;
      background: var(--primary);
      color: white;
      font-size: 0.625rem;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
    }

    .gallery-add-item {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      color: var(--muted-foreground);
      transition: all 0.2s;
    }

    .gallery-add-item:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: var(--accent);
    }

    .gallery-add-item svg {
      width: 24px;
      height: 24px;
    }

    .gallery-add-item span {
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Cuisine Tags */
    .cuisine-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .cuisine-tag {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      border: 2px solid var(--border);
      border-radius: 999px;
      background: var(--card);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .cuisine-tag:hover {
      border-color: var(--primary);
      background: var(--accent);
    }

    .cuisine-tag.selected {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }

    /* Slug Input */
    .slug-input-group {
      display: flex;
      align-items: stretch;
    }

    .slug-prefix {
      padding: 0.625rem 0.75rem;
      background: var(--background-secondary);
      border: 1px solid var(--border);
      border-right: none;
      border-radius: var(--radius) 0 0 var(--radius);
      font-size: 0.875rem;
      color: var(--muted);
      display: flex;
      align-items: center;
    }

    .slug-input-group .form-input {
      border-radius: 0 var(--radius) var(--radius) 0;
      flex: 1;
    }

    .slug-hint {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.375rem;
    }

    .slug-hint.error {
      color: var(--destructive);
    }
  </style>
</head>

<body>
  <div th:insert="~{components/sidebar :: sidebar(#{nav.settings})}"></div>

  <!-- Main Content -->
  <main class="main-content">
    <div th:insert="~{components/alert}"></div>

    <div class="dashboard-body">
      <form th:action="@{/settings}" th:object="${form}" method="post">
        <div class="settings-layout">

          <!-- Basic Information -->
          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.restaurant.title}">Restaurant Information</h2>
              <p th:text="#{section.restaurant.description}">Basic information that appears to your customers</p>
            </div>
            <div class="settings-section-body">
              <div class="logo-upload" style="margin-bottom: 1.5rem;" th:if="${false}">
                <div class="logo-preview" id="logoPreview">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7" />
                    <line x1="16" x2="22" y1="5" y2="5" />
                    <line x1="19" x2="19" y1="2" y2="8" />
                    <circle cx="9" cy="9" r="2" />
                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                  </svg>
                </div>
                <div class="logo-upload-actions">
                  <input type="file" id="logoInput" accept="image/*" style="display: none;">
                  <button class="btn btn-outline btn-sm" onclick="document.getElementById('logoInput').click()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                      <polyline points="17 8 12 3 7 8" />
                      <line x1="12" x2="12" y1="3" y2="15" />
                    </svg>
                    Enviar Logo
                  </button>
                  <p>PNG, JPG at√© 2MB. Recomendado: 200x200px</p>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="restaurantName" th:text="#{form.restaurant.name.required}">Restaurant
                  Name *</label>
                <input type="text" id="restaurantName" class="form-input" value="Cantina Bella Italia"
                  th:placeholder="#{form.restaurant.name.placeholder}" th:field="*{name}">
                <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" style="color:red"></div>
              </div>

              <div class="form-group">
                <label class="form-label" for="restaurantSlug" th:text="#{form.restaurant.slug}">Id *</label>
                <div class="slug-input-group">
                  <span class="slug-prefix" th:text="#{app.domain}+'/'">tablesplit.com/</span>
                  <input type="text" id="restaurantSlug" class="form-input" th:field="*{slug}"
                    th:placeholder="#{form.restaurant.slug.placeholder}" oninput="validateSlug(this)">
                </div>
                <p class="slug-hint" id="slugHint" th:text="#{form.restaurant.slug.hint}">Use only lowercase letters,
                  numbers, and underscores (_) or periods (.).</p>
                <div th:if="${#fields.hasErrors('slug')}" th:errors="*{slug}" style="color:red"></div>
              </div>

              <div class="form-group">
                <label class="form-label" for="restaurantDesc"
                  th:text="#{form.restaurant.description}">Description</label>
                <textarea id="restaurantDesc" class="form-textarea" rows="3" maxlength="254"
                  th:placeholder="#{form.restaurant.description.placeholder}" th:field="*{description}"></textarea>
                <div th:if="${#fields.hasErrors('description')}" th:errors="*{description}" style="color:red"></div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="restaurantPhone" th:text="#{form.restaurant.phone}">Phone</label>
                  <input type="tel" id="restaurantPhone" class="form-input" maxlength="20" th:field="*{phone}"
                    th:placeholder="#{form.restaurant.phone.placeholder}">
                  <div th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}" style="color:red"></div>
                </div>
                <div class="form-group">
                  <label class="form-label" for="restaurantEmail" th:text="#{form.restaurant.email}">Email *</label>
                  <input type="email" id="restaurantEmail" class="form-input" maxlength="254" th:field="*{email}"
                    th:placeholder="#{form.restaurant.email.placeholder}">
                  <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" style="color:red"></div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="restaurantAddress" th:text="#{form.restaurant.address}">Address</label>
                <input type="text" id="restaurantAddress" class="form-input" maxlength="254" th:field="*{address}"
                  th:placeholder="#{form.restaurant.address.placeholder}">
                <div th:if="${#fields.hasErrors('address')}" th:errors="*{address}" style="color:red"></div>
              </div>

              <div class="form-group">
                <label class="form-label" th:text="#{form.restaurant.cuisine.type}">Cuisine Type</label>
                <p class="form-hint" style="font-size: 0.75rem; color: var(--muted); margin-bottom: 0.75rem;"
                  th:text="#{form.restaurant.cuisine.type.hint}">Select the types that best describe your restaurant.
                </p>
                <div class="cuisine-tags" id="cuisineTags">
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('ITALIAN')} ? ' selected' : ''" data-cuisine="ITALIAN"
                    onclick="toggleCuisine(this)">üçù Italiana</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('JAPANESE')} ? ' selected' : ''" data-cuisine="JAPANESE"
                    onclick="toggleCuisine(this)">üç£ Japonesa</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('BRAZILIAN')} ? ' selected' : ''"
                    data-cuisine="BRAZILIAN" onclick="toggleCuisine(this)">üçñ Brasileira</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('MEXICAN')} ? ' selected' : ''" data-cuisine="MEXICAN"
                    onclick="toggleCuisine(this)">üåÆ Mexicana</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('FRENCH')} ? ' selected' : ''" data-cuisine="FRENCH"
                    onclick="toggleCuisine(this)">ü•ê Francesa</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('CHINESE')} ? ' selected' : ''" data-cuisine="CHINESE"
                    onclick="toggleCuisine(this)">ü•° Chinesa</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('INDIANA')} ? ' selected' : ''" data-cuisine="INDIANA"
                    onclick="toggleCuisine(this)">üçõ Indiana</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('ARABIC')} ? ' selected' : ''" data-cuisine="ARABIC"
                    onclick="toggleCuisine(this)">üßÜ √Årabe</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('AMERICAN')} ? ' selected' : ''" data-cuisine="AMERICAN"
                    onclick="toggleCuisine(this)">üçî Americana</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('FAST_FOOD')} ? ' selected' : ''" data-cuisine="FAST_FOOD"
                    onclick="toggleCuisine(this)">üçü Fast-Food</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('PIZZERIA')} ? ' selected' : ''" data-cuisine="PIZZERIA"
                    onclick="toggleCuisine(this)">üçï Pizzaria</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('CONTEMPORARY')} ? ' selected' : ''" data-cuisine="CONTEMPORARY"
                    onclick="toggleCuisine(this)">üçΩÔ∏è Contempor√¢nea</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('SEAFOOD')} ? ' selected' : ''" data-cuisine="SEAFOOD"
                    onclick="toggleCuisine(this)">ü¶ê Frutos do Mar</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('VEGETARIAN')} ? ' selected' : ''"
                    data-cuisine="VEGETARIAN" onclick="toggleCuisine(this)">ü•ó Vegetariana</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('STEAKHOUSE')} ? ' selected' : ''"
                    data-cuisine="STEAKHOUSE" onclick="toggleCuisine(this)">ü•© Churrascaria</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('CAFETERIA')} ? ' selected' : ''"
                    data-cuisine="CAFETERIA" onclick="toggleCuisine(this)">‚òï Cafeteria</button>
                  <button type="button" class="cuisine-tag"
                    th:classappend="${form.cuisineType.contains('SWEET_SHOP')} ? ' selected' : ''"
                    data-cuisine="SWEET_SHOP" onclick="toggleCuisine(this)">üç∞ Doceria</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Tags -->
          <div id="hiddenTagsContainer"></div>
          <div id="hiddenLanguagesContainer"></div>
          <div id="hiddenCuisineContainer"></div>

          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.tags.title}">Profile Tags</h2>
              <p th:text="#{section.tags.description}">Features and amenities of your restaurant</p>
            </div>
            <div class="settings-section-body">
              <div class="profile-tags-container" id="profileTags">
                <div class="profile-tag" th:each="tag, iterStat : *{tags}" th:attr="data-tag=${iterStat.index}">
                  <span class="tag-emoji" th:text="${tag.icon}">üç∑</span>
                  <span th:text="${tag.description}">
                    Vinhos
                  </span>
                  <button type="button" class="tag-remove" onclick="removeTag(this)">√ó</button>
                </div>
                <button type="button" class="add-tag-btn" onclick="showTagSuggestions()"
                  th:text="#{section.tags.button.add}">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 5v14" />
                    <path d="M5 12h14" />
                  </svg>
                  Add tag
                </button>
              </div>

              <div class="tag-suggestions" id="tagSuggestions" style="display: none;">
                <div class="tag-suggestion" onclick="addTag('estacionamento', 'üÖøÔ∏è', 'Estacionamento')">
                  <span>üÖøÔ∏è</span> Estacionamento
                </div>
                <div class="tag-suggestion" onclick="addTag('acessivel', '‚ôø', 'Acess√≠vel')">
                  <span>‚ôø</span> Acess√≠vel
                </div>
                <div class="tag-suggestion" onclick="addTag('delivery', 'üõµ', 'Delivery')">
                  <span>üõµ</span> Delivery
                </div>
                <div class="tag-suggestion" onclick="addTag('reservas', 'üìÖ', 'Reservas')">
                  <span>üìÖ</span> Reservas
                </div>
                <div class="tag-suggestion" onclick="addTag('kids', 'üë∂', 'Espa√ßo Kids')">
                  <span>üë∂</span> Espa√ßo Kids
                </div>
                <div class="tag-suggestion" onclick="addTag('live', 'üéµ', 'M√∫sica ao Vivo')">
                  <span>üéµ</span> M√∫sica ao Vivo
                </div>
                <div class="tag-suggestion" onclick="addTag('petfriendly', 'üêï', 'Pet Friendly')">
                  <span>üêï</span> Pet Friendly
                </div>
                <div class="tag-suggestion" onclick="addTag('ar', '‚ùÑÔ∏è', 'Ar Condicionado')">
                  <span>‚ùÑÔ∏è</span> Ar Condicionado
                </div>
                <div class="tag-suggestion" onclick="addTag('vegano', 'üå±', 'Vegano')">
                  <span>üå±</span> Vegano
                </div>
                <div class="tag-suggestion" onclick="addTag('glutenfree', 'üåæ', 'Sem Gl√∫ten')">
                  <span>üåæ</span> Sem Gl√∫ten
                </div>
                <div class="tag-suggestion" onclick="addTag('romantico', 'üíë', 'Rom√¢ntico')">
                  <span>üíë</span> Rom√¢ntico
                </div>
                <div class="tag-suggestion" onclick="addTag('grupos', 'üë•', 'Grupos')">
                  <span>üë•</span> Grupos
                </div>
              </div>
            </div>
          </div>

          <!-- Languages -->
          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.languages.title}">Languages</h2>
              <p th:text="#{section.languages.description}">Configure the languages available for your customers</p>
            </div>
            <div class="settings-section-body">
              <div class="form-group">
                <label class="form-label" for="primaryLanguage" th:text="#{form.language.primary}">Primary Language
                  *</label>
                <p style="font-size: 0.75rem; color: var(--muted); margin-bottom: 0.5rem;"
                  th:text="#{form.language.primary.hint}">Used in the restaurant admin area</p>
                <select id="primaryLanguage" class="form-select" onchange="updateLanguages()"
                  th:field="*{defaultLanguage}">
                  <option value="en-US" selected>English (US)</option>
                  <option value="pt-BR">Portugu√™s (Brasil)</option>
                  <option value="es-ES" th:if="${false}">Espa√±ol</option>
                  <option value="fr-FR" th:if="${false}">Fran√ßais</option>
                  <option value="it-IT" th:if="${false}">Italiano</option>
                  <option value="de-DE" th:if="${false}">Deutsch</option>
                  <option value="ja-JP" th:if="${false}">Êó•Êú¨Ë™û</option>
                  <option value="zh-CN" th:if="${false}">‰∏≠Êñá</option>
                </select>
                <div th:if="${#fields.hasErrors('defaultLanguage')}" th:errors="*{defaultLanguage}" style="color:red">
                </div>
              </div>

              <div class="form-group" style="margin-top: 1.5rem;">
                <label class="form-label" th:text="#{form.language.available}">Languages Available for Customers</label>
                <p style="font-size: 0.75rem; color: var(--muted); margin-bottom: 0.75rem;"
                  th:text="#{form.language.available.hint}">Select the languages that will be available in the digital
                  menu</p>
                <div class="language-checkboxes" id="languageCheckboxes">
                  <label class="language-checkbox">
                    <input type="checkbox" value="pt-BR" onchange="toggleLanguage(this)"
                      th:disabled="${form.customerLanguages != null and !#lists.isEmpty(form.customerLanguages) and form.customerLanguages[0].code == 'pt-BR'}"
                      th:checked="${form.customerLanguages != null and #lists.contains(form.customerLanguages.![code], 'pt-BR')}">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üáßüá∑</span>
                    <span class="lang-name">Portugu√™s (Brasil)</span>
                    <span class="lang-badge primary"
                      th:if="${form.customerLanguages != null and !#lists.isEmpty(form.customerLanguages) and form.customerLanguages[0].code == 'pt-BR'}">Principal</span>
                  </label>
                  <label class="language-checkbox">
                    <input type="checkbox" value="en-US" onchange="toggleLanguage(this)"
                      th:disabled="${form.customerLanguages != null and !#lists.isEmpty(form.customerLanguages) and form.customerLanguages[0].code == 'en-US'}"
                      th:checked="${form.customerLanguages != null and #lists.contains(form.customerLanguages.![code], 'en-US')}">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üá∫üá∏</span>
                    <span class="lang-name">English (US)</span>
                    <span class="lang-badge primary"
                      th:if="${form.customerLanguages != null and !#lists.isEmpty(form.customerLanguages) and form.customerLanguages[0].code == 'en-US'}">Principal</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="es-ES" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üá™üá∏</span>
                    <span class="lang-name">Espa√±ol</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="fr-FR" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üá´üá∑</span>
                    <span class="lang-name">Fran√ßais</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="it-IT" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üáÆüáπ</span>
                    <span class="lang-name">Italiano</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="de-DE" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üá©üá™</span>
                    <span class="lang-name">Deutsch</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="ja-JP" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üáØüáµ</span>
                    <span class="lang-name">Êó•Êú¨Ë™û (Japanese)</span>
                  </label>
                  <label class="language-checkbox" th:if="${false}">
                    <input type="checkbox" value="zh-CN" onchange="toggleLanguage(this)">
                    <span class="checkmark"></span>
                    <span class="lang-flag">üá®üá≥</span>
                    <span class="lang-name">‰∏≠Êñá (Chinese)</span>
                  </label>
                </div>
              </div>

              <div class="selected-languages" id="selectedLanguages" style="margin-top: 1rem;">
                <p style="font-size: 0.75rem; color: var(--muted); margin-bottom: 0.5rem;"
                  th:text="#{language.selected}">Selected languages (drag to reorder):</p>
                <div class="language-tags" id="languageTags">
                  <div th:each="lang, stat : *{customerLanguages}">
                    <span class="language-tag" th:classappend="${stat.index == 0} ? ' primary' : ''" draggable="true"
                      th:attr="data-lang=${lang.code}" th:text="${lang.label}"></span>
                  </div>
                </div>
                <p class="language-tags-hint" th:text="#{language.hint}">The first language will be the main menu
                  language</p>
              </div>
            </div>
          </div>

          <!-- Financial Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.financial.title}">Financial Settings</h2>
              <p th:text="#{section.financial.description}">Service fee and currency used</p>
            </div>
            <div class="settings-section-body">
              <div class="form-row-3">
                <div class="form-group">
                  <label class="form-label" for="currency" th:text="#{form.currency}">Currency</label>
                  <select id="currency" class="form-select" th:field="*{currency}">
                    <option value="EUR" selected th:text="#{form.currency.eur}">‚Ç¨ (Euro)</option>
                    <option value="BRL" th:text="#{form.currency.brl}">R$ (Real)</option>
                    <option value="USD" th:if="${false}">$ (D√≥lar)</option>
                  </select>
                  <div th:if="${#fields.hasErrors('currency')}" th:errors="*{currency}" style="color:red"></div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="serviceFee" th:text="#{form.service.fee}">Service Fee</label>
                  <div class="input-with-addon">
                    <input type="number" id="serviceFee" class="form-input" th:field="*{serviceFee}" min="0" max="100"
                      step="1">
                    <span class="input-addon">%</span>
                  </div>
                  <div th:if="${#fields.hasErrors('serviceFee')}" th:errors="*{serviceFee}" style="color:red"></div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="averagePrice" th:text="#{form.average.price}">Average Price</label>
                  <div class="input-with-addon">
                    <select id="averagePrice" class="form-select" th:field="*{averagePrice}">
                      <option value="1-20" selected>$ 1 - $ 20</option>
                      <option value="20-50">$ 20 - $ 50</option>
                      <option value="50-100">$ 50 - $ 100</option>
                      <option value="100-200">$ 100 - $ 200</option>
                      <option value="200-450">$ 200 - $ 450</option>
                    </select>
                    <div th:if="${#fields.hasErrors('averagePrice')}" th:errors="*{averagePrice}" style="color:red">
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-switch" style="margin-top: 1rem;" th:if="${false}">
                <div class="form-switch-label">
                  <label class="form-label" style="margin-bottom: 0;">Incluir taxa de servi√ßo automaticamente</label>
                  <p>A taxa ser√° adicionada ao total da conta</p>
                </div>
                <div id="autoServiceFee" class="switch active" onclick="toggleSwitch(this)"></div>
              </div>
            </div>
          </div>

          <!-- Opening Hours -->
          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.hours.title}">Business Hours</h2>
              <p th:text="#{section.hours.description}">Define the opening and closing hours (you can add multiple time
                periods per day)</p>
            </div>
            <div class="settings-section-body">
              <div id="hoursContainer">
                <div class="day-schedule" th:data-day="${day.day}" th:data-closed="${day.closed}"
                  th:data-day-index="${dayStat.index}" th:each="day, dayStat : *{days}">
                  <input type="hidden" th:field="*{days[__${dayStat.index}__].day}" />
                  <input type="hidden" th:field="*{days[__${dayStat.index}__].closed}" />
                  <div class="day-header" th:classappend="${day.closed} ? ' closed' : ''">
                    <span class="day-name" th:text="#{${'day.' + day.day}}">Monday</span>
                    <div class="day-actions">
                      <span class="closed-badge" th:text="#{hours.closed}" th:if="${day.closed}">Closed</span>
                      <button type="button" class="btn btn-ghost btn-sm"
                        th:attr="onclick=|toggleDaySchedule('${day.day}')|" th:title="#{hours.toggle.open}">
                        <svg xmlns="http://www.w3.org/2000/svg" th:if="${day.closed}" width="16" height="16"
                          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                          <path d="m9 11 3 3L22 4" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" th:if="${!day.closed}" width="16" height="16"
                          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round">
                          <circle cx="12" cy="12" r="10" />
                          <path d="m15 9-6 6" />
                          <path d="m9 9 6 6" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="periods-container" th:if="${!day.closed}">
                    <div class="period-row" th:each="period, periodStat : *{days[__${dayStat.index}__].periods}">
                      <input type="time" class="hours-input"
                        th:field="*{days[__${dayStat.index}__].periods[__${periodStat.index}__].start}">
                      <span class="period-separator" th:text="#{period.until}">until</span>
                      <input type="time" class="hours-input"
                        th:field="*{days[__${dayStat.index}__].periods[__${periodStat.index}__].end}">
                      <button type="button" class="remove-period-btn" onclick="removePeriod(this)"
                        th:title="#{period.remove}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M18 6 6 18" />
                          <path d="m6 6 12 12" />
                        </svg>
                      </button>
                    </div>
                    <button type="button" class="add-period-btn" onclick="addPeriod(this)" th:text="#{period.add}">
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 5v14" />
                        <path d="M5 12h14" />
                      </svg>
                      Add period
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Appearance -->
          <div class="settings-section">
            <div class="settings-section-header">
              <h2 th:text="#{section.appearance.title}">Menu Appearance</h2>
              <p th:text="#{section.appearance.description}">Customize the digital menu colors</p>
            </div>
            <div class="settings-section-body">
              <div class="form-row-3">
                <div class="form-group">
                  <label class="form-label" th:text="#{form.color.primary}">Primary Color</label>
                  <div class="color-picker-group">
                    <label class="color-preview">
                      <input type="color" class="color-input" th:field="*{hashPrimaryColor}">
                    </label>
                    <input type="text" class="form-input color-text" maxlength="7" style="font-family: monospace;"
                      th:value="*{hashPrimaryColor}" name="">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" th:text="#{form.color.accent}">Accent Color</label>
                  <div class="color-picker-group">
                    <label class="color-preview">
                      <input type="color" class="color-input" th:field="*{hashAccentColor}">
                    </label>
                    <input type="text" class="form-input color-text" maxlength="7" style="font-family: monospace;"
                      th:value="*{hashAccentColor}" name="">
                  </div>
                </div>

                <div class="form-group" th:if="${false}">
                  <label class="form-label">Fundo do Menu</label>
                  <select class="form-select">
                    <option value="light" selected>Claro</option>
                    <option value="dark">Escuro</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Notifications -->
          <div class="settings-section" th:if="${false}">
            <div class="settings-section-header">
              <h2>Notifica√ß√µes</h2>
              <p>Configure como voc√™ recebe alertas</p>
            </div>
            <div class="settings-section-body">
              <div class="form-switch" style="margin-bottom: 1rem;">
                <div class="form-switch-label">
                  <label class="form-label" style="margin-bottom: 0;">Notifica√ß√µes de novos pedidos</label>
                  <p>Receba alertas quando um cliente fizer um pedido</p>
                </div>
                <div class="switch active" onclick="toggleSwitch(this)"></div>
              </div>

              <div class="form-switch" style="margin-bottom: 1rem;">
                <div class="form-switch-label">
                  <label class="form-label" style="margin-bottom: 0;">Alertas de "Chamar Gar√ßom"</label>
                  <p>Notifica√ß√£o sonora quando cliente solicitar atendimento</p>
                </div>
                <div class="switch active" onclick="toggleSwitch(this)"></div>
              </div>

              <div class="form-switch">
                <div class="form-switch-label">
                  <label class="form-label" style="margin-bottom: 0;">Email de resumo di√°rio</label>
                  <p>Receba um resumo das vendas do dia por email</p>
                </div>
                <div class="switch" onclick="toggleSwitch(this)"></div>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="settings-section danger-zone" th:if="${false}">
            <div class="settings-section-header">
              <h2>Zona de Perigo</h2>
              <p>A√ß√µes irrevers√≠veis</p>
            </div>
            <div class="settings-section-body">
              <div
                style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                <div>
                  <p style="font-weight: 500; margin-bottom: 0.25rem;">Excluir Restaurante</p>
                  <p style="font-size: 0.875rem; color: var(--muted);">Esta a√ß√£o n√£o pode ser desfeita. Todos os dados
                    ser√£o perdidos.</p>
                </div>
                <button class="btn btn-outline" style="border-color: var(--destructive); color: var(--destructive);">
                  Excluir Restaurante
                </button>
              </div>
            </div>
          </div>

          <!-- Footer Actions -->
          <div class="settings-footer">
            <button class="btn btn-outline" th:text="#{button.cancel}">Cancel</button>
            <button class="btn btn-primary" type="submit" th:text="#{button.save}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                <polyline points="17 21 17 13 7 13 7 21" />
                <polyline points="7 3 7 8 15 8" />
              </svg>
              Save Changes
            </button>
          </div>
        </div>
      </form>
    </div>
  </main>

  <script th:inline="javascript">
    // Business Hours functions
    const i18n = {
      open: /*[[#{hours.toggle.open}]]*/ 'Open',
      close: /*[[#{hours.toggle.close}]]*/ 'Close',
      closed: /*[[#{hours.closed}]]*/ 'Closed',
      until: /*[[#{period.until}]]*/ 'to',
      removePeriod: /*[[#{period.remove}]]*/ 'Remove period',
      addPeriod: /*[[#{period.add}]]*/ 'Add period',
      minOnePeriod: /*[[#{period.minimum.message}]]*/ 'There must be at least one period. To close the day, use the close button.',
      slugHint: /*[[#{form.restaurant.slug.hint}]]*/ 'Use only lowercase letters, numbers, and underscores (_) or periods (.).',
      slugInvalid: /*[[#{form.restaurant.slug.validation.error.invalid}]]*/ 'Invalid characters detected',
      slugLength: /*[[#{form.restaurant.slug.validation.error.length}]]*/ 'The slug must have at least 3 characters',
      domain: /*[[#{app.domain}]]*/ 'tablesplit.com'
    };
  </script>

  <script>
    // Slug validation
    function validateSlug(input) {
      const value = input.value;
      const hint = document.getElementById('slugHint');
      const validPattern = /^[a-z0-9_]*$/;

      // Auto-format: lowercase, replace spaces/hyphens with underscore
      let formatted = value.toLowerCase()
        .replace(/\s+/g, '_')
        .replace(/-/g, '_')
        .replace(/[^a-z0-9_]/g, '');

      if (formatted !== value) {
        input.value = formatted;
      }

      if (formatted.length === 0) {
        hint.textContent = i18n.slugHint;
        hint.classList.remove('error');
      } else if (!validPattern.test(formatted)) {
        hint.textContent = i18n.slugInvalid;
        hint.classList.add('error');
      } else if (formatted.length < 3) {
        hint.textContent = i18n.slugLength;
        hint.classList.add('error');
      } else {
        hint.textContent = i18n.domain + '/' + formatted;
        hint.classList.remove('error');
      }
    }

    // Cuisine type toggle
    function toggleCuisine(btn) {
      btn.classList.toggle('selected');
      syncHiddenCuisines();
    }

    function syncHiddenCuisines() {
      const container = document.getElementById('hiddenCuisineContainer');
      container.innerHTML = '';
      const selected = document.querySelectorAll('#cuisineTags .cuisine-tag.selected');
      selected.forEach(btn => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'cuisineType';
        input.value = btn.dataset.cuisine;
        container.appendChild(input);
      });
    }

    // Toggle switch
    function toggleSwitch(el) {
      el.classList.toggle('active');
    }

    /* Logo preview
    document.getElementById('logoInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('logoPreview');
          preview.innerHTML = '<img src="' + e.target.result + '" alt="Logo">';
        };
        reader.readAsDataURL(file);
      }
    });*/

    // Profile Tags functions
    function syncHiddenTags() {
      const container = document.getElementById('hiddenTagsContainer');
      container.innerHTML = '';

      const tags = document.querySelectorAll('#profileTags .profile-tag');

      tags.forEach((tag, index) => {
        const icon = tag.querySelector('.tag-emoji').textContent.trim();
        const description = tag.querySelector('span:nth-child(2)').textContent.trim();

        const iconInput = document.createElement('input');
        iconInput.type = 'hidden';
        iconInput.name = `tags[${index}].icon`;
        iconInput.value = icon;

        const descInput = document.createElement('input');
        descInput.type = 'hidden';
        descInput.name = `tags[${index}].description`;
        descInput.value = description;

        container.appendChild(iconInput);
        container.appendChild(descInput);
      });
    }

    function showTagSuggestions() {
      const suggestions = document.getElementById('tagSuggestions');
      suggestions.style.display =
        suggestions.style.display === 'none' ? 'grid' : 'none';
      updateTagSuggestions();
    }

    function updateTagSuggestions() {
      const existingTags = Array.from(
        document.querySelectorAll('#profileTags .profile-tag')
      ).map(t => t.dataset.tag);

      document.querySelectorAll('.tag-suggestion').forEach(s => {
        const tagId = s.getAttribute('onclick').match(/addTag\('([^']+)'/)[1];
        s.classList.toggle('selected', existingTags.includes(tagId));
      });
    }

    function addTag(id, emoji, label) {
      const container = document.getElementById('profileTags');
      const addBtn = container.querySelector('.add-tag-btn');

      if (container.querySelector(`[data-tag="${id}"]`)) {
        removeTagById(id);
        updateTagSuggestions();
        syncHiddenTags();
        return;
      }

      const tag = document.createElement('div');
      tag.className = 'profile-tag';
      tag.dataset.tag = id;
      tag.innerHTML = `
      <span class="tag-emoji">${emoji}</span>
      <span>${label}</span>
      <button type="button" class="tag-remove" onclick="removeTag(this)">√ó</button>
    `;

      container.insertBefore(tag, addBtn);

      updateTagSuggestions();
      syncHiddenTags();
    }

    function removeTag(btn) {
      btn.closest('.profile-tag').remove();
      updateTagSuggestions();
      syncHiddenTags();
    }

    function removeTagById(id) {
      const tag = document.querySelector(`#profileTags [data-tag="${id}"]`);
      if (tag) tag.remove();
    }

    // üî• GARANTE que as tags iniciais sejam enviadas
    document.addEventListener('DOMContentLoaded', function () {
      syncHiddenTags();
    });

    // üî• GARANTE que antes do submit esteja sincronizado
    document.querySelector('form').addEventListener('submit', function () {
      syncHiddenTags();
      syncHiddenLanguages();
    });

    // Language management
    function syncHiddenLanguages() {
      const container = document.getElementById('hiddenLanguagesContainer');
      if (!container) return;
      container.innerHTML = '';

      const tags = document.querySelectorAll('#languageTags .language-tag');

      tags.forEach((tag, index) => {
        const code = tag.dataset.lang;
        const label = tag.textContent.trim();

        const codeInput = document.createElement('input');
        codeInput.type = 'hidden';
        codeInput.name = `customerLanguages[${index}].code`;
        codeInput.value = code;
        codeInput.className = 'lang-code';

        const labelInput = document.createElement('input');
        labelInput.type = 'hidden';
        labelInput.name = `customerLanguages[${index}].label`;
        labelInput.value = label;
        labelInput.className = 'lang-label';

        container.appendChild(codeInput);
        container.appendChild(labelInput);
      });
    }
    function updateLanguages() {
      const primary = document.getElementById('primaryLanguage').value;

      // Move selected language to first position in order
      const currentIndex = languageOrder.indexOf(primary);
      if (currentIndex > 0) {
        languageOrder.splice(currentIndex, 1);
        languageOrder.unshift(primary);
      } else if (currentIndex === -1) {
        // Language not in order yet, add it and check its checkbox
        languageOrder.unshift(primary);
        const checkbox = document.querySelector(`.language-checkbox input[value="${primary}"]`);
        if (checkbox) checkbox.checked = true;
      }

      updateLanguageTags();
    }

    function toggleLanguage(checkbox) {
      updateLanguageTags();
    }

    const langNames = {
      'pt-BR': 'üáßüá∑ Portugu√™s',
      'en-US': 'üá∫üá∏ English',
      'es-ES': 'üá™üá∏ Espa√±ol',
      'fr-FR': 'üá´üá∑ Fran√ßais',
      'it-IT': 'üáÆüáπ Italiano',
      'de-DE': 'üá©üá™ Deutsch',
      'ja-JP': 'üáØüáµ Êó•Êú¨Ë™û',
      'zh-CN': 'üá®üá≥ ‰∏≠Êñá'
    };

    // Track language order (first = primary)
    let languageOrder = /*[[${form.customerLanguages.![code]}]]*/['pt-BR', 'en-US'];

    function updateLanguageTags() {
      const checked = Array.from(document.querySelectorAll('.language-checkbox input:checked')).map(cb => cb.value);
      const tagsContainer = document.getElementById('languageTags');

      // Update order: keep existing order, add new ones at end, remove unchecked
      languageOrder = languageOrder.filter(lang => checked.includes(lang));
      checked.forEach(lang => {
        if (!languageOrder.includes(lang)) languageOrder.push(lang);
      });

      // Render tags
      tagsContainer.innerHTML = languageOrder.map((lang, index) =>
        `<span class="language-tag ${index === 0 ? 'primary' : ''}" draggable="true" data-lang="${lang}">${langNames[lang]}</span>`
      ).join('');

      // Re-attach drag events
      initDragAndDrop();

      // Update hidden inputs
      syncHiddenLanguages();

      // Update primary language select
      updatePrimaryFromOrder();
    }

    function updatePrimaryFromOrder() {
      if (languageOrder.length > 0) {
        //const primarySelect = document.getElementById('primaryLanguage');
        const newPrimary = languageOrder[0];
        //primarySelect.value = newPrimary;

        // Update checkbox badges
        document.querySelectorAll('.language-checkbox').forEach(label => {
          const cb = label.querySelector('input');
          const badge = label.querySelector('.lang-badge');

          if (cb.value === newPrimary) {
            cb.disabled = true;
            if (!badge) {
              const newBadge = document.createElement('span');
              newBadge.className = 'lang-badge primary';
              newBadge.textContent = 'Principal';
              label.appendChild(newBadge);
            }
          } else {
            cb.disabled = false;
            if (badge) badge.remove();
          }
        });
      }
    }

    // Drag and Drop
    let draggedElement = null;

    function initDragAndDrop() {
      const tags = document.querySelectorAll('#languageTags .language-tag');

      tags.forEach(tag => {
        tag.addEventListener('dragstart', handleDragStart);
        tag.addEventListener('dragend', handleDragEnd);
        tag.addEventListener('dragover', handleDragOver);
        tag.addEventListener('dragenter', handleDragEnter);
        tag.addEventListener('dragleave', handleDragLeave);
        tag.addEventListener('drop', handleDrop);
      });
    }

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', this.dataset.lang);
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      document.querySelectorAll('.language-tag').forEach(tag => {
        tag.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleDragEnter(e) {
      e.preventDefault();
      if (this !== draggedElement) {
        this.classList.add('drag-over');
      }
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      e.preventDefault();
      this.classList.remove('drag-over');

      if (this !== draggedElement) {
        const draggedLang = draggedElement.dataset.lang;
        const targetLang = this.dataset.lang;

        const draggedIndex = languageOrder.indexOf(draggedLang);
        const targetIndex = languageOrder.indexOf(targetLang);

        // Remove dragged from current position
        languageOrder.splice(draggedIndex, 1);
        // Insert at target position
        languageOrder.splice(targetIndex, 0, draggedLang);

        // Re-render
        updateLanguageTags();
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      initDragAndDrop();
      syncHiddenLanguages();
      syncHiddenCuisines();
    });

    function toggleDaySchedule(day) {
      const schedule = document.querySelector(`[data-day="${day}"]`);
      const closedInput = schedule.querySelector("input[name$='.closed']");
      const isClosed = schedule.dataset.closed === 'true';
      closedInput.value = (!isClosed).toString();

      if (isClosed) {
        // Open the day
        schedule.dataset.closed = 'false';
        const header = schedule.querySelector('.day-header');
        header.classList.remove('closed');
        header.querySelector('.closed-badge')?.remove();
        header.querySelector('.btn').innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
        `;
        header.querySelector('.btn').title = i18n.close;

        // Add periods container
        const dayIndex = schedule.dataset.dayIndex;
        const periodRows = schedule.querySelectorAll('.period-row');
        const periodIndex = periodRows.length;

        const periodsContainer = document.createElement('div');
        periodsContainer.className = 'periods-container';
        periodsContainer.innerHTML = `
          <div class="period-row">
            <input type="time" class="hours-input" name="days[${dayIndex}].periods[${periodIndex}].start" value="11:30">
            <span class="period-separator">`+ i18n.until + `</span>
            <input type="time" class="hours-input" name="days[${dayIndex}].periods[${periodIndex}].end" value="23:00">
            <button type="button" class="remove-period-btn" onclick="removePeriod(this)" title="`+ i18n.removePeriod + `">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
          </div>
          <button type="button" class="add-period-btn" onclick="addPeriod(this)">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
            `+ i18n.addPeriod + `
          </button>
        `;
        schedule.appendChild(periodsContainer);
      } else {
        // Close the day
        schedule.dataset.closed = 'true';
        const header = schedule.querySelector('.day-header');
        header.classList.add('closed');

        const badge = document.createElement('span');
        badge.className = 'closed-badge';
        badge.textContent = i18n.closed;
        header.querySelector('.day-actions').insertBefore(badge, header.querySelector('.btn'));

        header.querySelector('.btn').innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
        `;
        header.querySelector('.btn').title = i18n.open;

        // Remove periods container
        schedule.querySelector('.periods-container')?.remove();
      }
    }

    function addPeriod(btn) {
      const container = btn.closest('.periods-container');
      const schedule = btn.closest('.day-schedule');
      const dayIndex = schedule.dataset.dayIndex;

      const periodRows = container.querySelectorAll('.period-row');
      const periodIndex = periodRows.length;

      const periodRow = document.createElement('div');
      periodRow.className = 'period-row';
      periodRow.innerHTML = `
        <input type="time" class="hours-input" name="days[${dayIndex}].periods[${periodIndex}].start" value="18:00">
        <span class="period-separator">`+ i18n.until + `</span>
        <input type="time" class="hours-input" name="days[${dayIndex}].periods[${periodIndex}].end" value="23:00">
        <button type="button" class="remove-period-btn" onclick="removePeriod(this)" title="Remover per√≠odo">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      `;
      container.insertBefore(periodRow, btn);
    }

    function removePeriod(btn) {
      const container = btn.closest('.periods-container');
      const schedule = btn.closest('.day-schedule');
      const dayIndex = schedule.dataset.dayIndex;

      const periods = container.querySelectorAll('.period-row');

      // Don't remove if it's the only period
      if (periods.length <= 1) {
        alert(i18n.minOnePeriod);
        return;
      }

      btn.closest('.period-row').remove();
      reindexPeriods(container, dayIndex);
    }

    function reindexPeriods(container, dayIndex) {

      const rows = container.querySelectorAll('.period-row');

      rows.forEach((row, periodIndex) => {

        const startInput = row.querySelector('input[name$=".start"]');
        const endInput = row.querySelector('input[name$=".end"]');

        if (startInput) {
          startInput.name = `days[${dayIndex}].periods[${periodIndex}].start`;
        }

        if (endInput) {
          endInput.name = `days[${dayIndex}].periods[${periodIndex}].end`;
        }

      });
    }


    // Color select
    document.querySelectorAll('.color-picker-group').forEach(group => {

      const colorInput = group.querySelector('.color-input');
      const textInput = group.querySelector('.color-text');
      const preview = group.querySelector('.color-preview');

      function updateUI(value) {
        preview.style.background = value;
        textInput.value = value.toUpperCase();
        colorInput.value = value;
      }

      // Inicializa com valor vindo do backend (th:field)
      if (colorInput.value) {
        updateUI(colorInput.value);
      }

      // Quando altera no color picker
      colorInput.addEventListener('input', () => {
        updateUI(colorInput.value);
      });

      // Quando digita no campo texto
      textInput.addEventListener('input', () => {
        let value = textInput.value.trim();

        // Auto adiciona # se esquecer
        if (value && !value.startsWith('#')) {
          value = '#' + value;
        }

        // Valida√ß√£o HEX
        if (/^#([0-9A-F]{3}){1,2}$/i.test(value)) {
          updateUI(value);
        }
      });

    });
  </script>
</body>

</html>